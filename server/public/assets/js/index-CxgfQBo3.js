const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/Docs-B5YfUMSX.js","assets/js/vendor-DLaggKmm.js","assets/css/vendor-CEtrrJ3D.css","assets/css/Docs-CH1DIOFv.css","assets/js/Gallery-n1uC2e8O.js","assets/js/404-D23t8Jcl.js","assets/js/ImageInfoModal-CnEU1Ql8.js","assets/js/formatDate-DJT1dS-E.js","assets/css/ImageInfoModal-tRT01gUY.css","assets/css/Gallery-BRD9MRC_.css","assets/js/Home-6-0TPyDh.js","assets/css/Home-CNP6c67e.css","assets/js/Login-9l3RuAuk.js","assets/js/Captcha-DQq_KA5R.js","assets/css/Captcha-B4dJo8cr.css","assets/css/Login-CSg1sMM2.css","assets/js/My-BRjIdCfe.js","assets/css/My-BHKg8uo6.css","assets/js/Not-CwyOAELb.js","assets/js/Register-D8h7w0jo.js","assets/css/Register-5THYRdjf.css","assets/js/ResetPassword-CI7AcKCg.js","assets/css/ResetPassword-DcGo0DMz.css","assets/js/Settings-BYvvCdpO.js","assets/css/Settings-DR8wUfjp.css","assets/js/Albums-BNnkeUdg.js","assets/css/Albums-BeUheVyf.css","assets/js/Announcements-DZZGhZ3k.js","assets/css/Announcements-MP1YgNey.css","assets/js/Config-iHjIVkg8.js","assets/css/Config-DZHcsgWe.css","assets/js/Dashboard-DPDkKNvj.js","assets/css/Dashboard-CMeUS86o.css","assets/js/Images-DZ2e99ti.js","assets/css/Images-Czs-pqPb.css","assets/js/InviteCodes-BgoW2MNz.js","assets/css/InviteCodes-kfsrbmKC.css","assets/js/Logs-l-SRRieQ.js","assets/css/Logs-DNxzLh9c.css","assets/js/RoleGroups-DiZtqGTu.js","assets/css/RoleGroups-CbxAK3F2.css","assets/js/Users-B-CXa6EZ.js","assets/css/Users-D0JLivEe.css","assets/js/UserPage-CyWIf2aQ.js","assets/css/UserPage-CNo6k55W.css","assets/js/UserPublicAlbumDetail-CgWzgIZF.js","assets/css/UserPublicAlbumDetail-C7JQ2f0J.css"])))=>i.map(i=>d[i]);
import{d as e,a as t,u as n,b as s,r as o,w as a,o as i,c as l,e as r,f as u,g as c,h as d,i as m,j as v,M as _,k as p,l as g,A as f,U as h,m as y,n as w,_ as E,p as b,S as k,q as P,L as A,s as D,D as L,t as O,v as R,F as T,x as I,y as j,z as C,P as V,B as S,C as U,H as N,E as x,G as M,Q as $,I as q,J as B,K as G,N as H,O as J,R as z,T as K}from"./vendor-DLaggKmm.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const F=e("user",{state:()=>({ip:null,user:null,guest:null,token:null,config:null,activeKey:"1",announcement:null,announcementData:null}),getters:{menuVisibility:e=>{var t,n,s,o;return{home:!0,my:!!e.token,gallery:!!(null==(n=null==(t=e.config)?void 0:t.site)?void 0:n.gallery),docs:!!(null==(o=null==(s=e.config)?void 0:s.site)?void 0:o.api)}}},persist:{key:"stb",storage:localStorage,serializer:{serialize:e=>JSON.stringify(e),deserialize:e=>JSON.parse(e)}}}),Q=e=>{const{method:t,url:n,params:s,data:o}=e;return[t,n,JSON.stringify(s),JSON.stringify(o)].join("&")},W=new Map,Y=e=>{const t=Q(e);if(W.has(t)){W.get(t)(t),W.delete(t)}},X=t.create({baseURL:"",timeout:1e4});X.interceptors.request.use((e=>{Y(e),(e=>{const n=Q(e);e.cancelToken=e.cancelToken||new t.CancelToken((e=>{W.has(n)||W.set(n,e)}))})(e);const{token:n}=JSON.parse(localStorage.getItem("stb"))||{};return e.headers.Authorization=n?`Bearer ${n}`:"",e}),(e=>Promise.reject(e))),X.interceptors.response.use((e=>(Y(e.config),e)),(e=>{var t,n;const s=JSON.parse(localStorage.getItem("stb"))||{};return(null==(t=null==s?void 0:s.site)?void 0:t.anonymousUpload)||401!==(null==(n=e.response)?void 0:n.status)||(localStorage.removeItem("stb"),location.href="/login"),Y(e.config||{}),Promise.reject(e)}));const Z=(e,t)=>{const n=e.__vccOpts||e;for(const[s,o]of t)n[s]=o;return n},ee={class:"app"},te={class:"app-header"},ne={class:"app-header-left"},se={class:"app-header-right"},oe={class:"logo"},ae={class:"footer"},ie={type:"link",href:"https://beian.miit.gov.cn",target:"_blank"},le=["innerHTML"],re=Z({__name:"App",setup(e){const t=n(),G=s(),H=F(),J=o(["home"]),z=o(!1),K=o(null),Q=o({ipv4:"",ipv6:""}),W=[{name:"home",title:"图床首页",url:"/home",icon:N},{name:"my",title:"我的图片",url:"/my",icon:x},{name:"gallery",title:"图片广场",url:"/gallery",icon:M},{name:"docs",title:"接口文档",url:"/docs",icon:$}],Y=o([]),Z=[{name:"dashboard",title:"仪表盘"},{name:"logs",title:"日志管理"},{name:"users",title:"用户管理"},{name:"images",title:"图片管理"},{name:"albums",title:"相册管理"},{name:"announcements",title:"公告管理"},{name:"config",title:"系统配置"},{name:"rolegroups",title:"角色组管理"},{name:"invitecodes",title:"邀请码管理"}],re=async()=>{H.user=H.guest,H.token=null,G.push("/login"),q.warning("账号已退出")},ue=e=>{const t=e.split("/").filter(Boolean);if(["register","resetpassword"].includes(t[0]))return J.value=["login"];J.value=t.length>1?[t[1]]:[t[0]||"home"]};return a((()=>t.path),(async e=>{await(e=>{const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.qq.com"},{urls:"stun:stun.cloudflare.com:3478"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]});t.createDataChannel(""),t.createOffer().then((e=>t.setLocalDescription(e))),t.onicecandidate=t=>{t.candidate&&e(t.candidate.candidate.split(" ")[4])}})((e=>{try{/\b(?:\d{1,3}\.){3}\d{1,3}\b/.test(e)?Q.value.ipv4=e:/^(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(e)&&(Q.value.ipv6=e),H.ip=Q.value}catch(t){console.error(t)}})),ue(e),await(async()=>{var e;try{const{data:e}=await X.post("/api/auth/guest");H.guest=e}catch({response:t}){q.error(null==(e=null==t?void 0:t.data)?void 0:e.error)}})()})),i((async()=>{if((async()=>{var e,t;try{const{data:t}=await X.post("/api/auth/config");H.config=t;const n=null==(e=null==t?void 0:t.site)?void 0:e.navigationOrder,s=[...W].sort(((e,t)=>n.indexOf(e.name)-n.indexOf(t.name)));Y.value=s.map((e=>({...e,show:H.menuVisibility[e.name]})))}catch({response:n}){q.error(null==(t=null==n?void 0:n.data)?void 0:t.error)}})(),ue(location.pathname),(()=>{const e=new URLSearchParams(location.search),t=e.get("token"),n=e.get("isBind");t&&(H.token=t,history.replaceState({},document.title,location.pathname),"true"===n?G.push("/settings"):G.push("/"))})(),(async()=>{var e,t,n,s;try{const{data:s}=await X.post("/api/admin/announcements/active");if(s){H.announcementData=s;let o=Date.now(),a=(null==(e=null==H?void 0:H.announcement)?void 0:e.nextTime)?null==(t=null==H?void 0:H.announcement)?void 0:t.nextTime:Date.now();s._id!=(null==(n=null==H?void 0:H.announcement)?void 0:n._id)&&(H.announcements=null,a=Date.now()),"modal"===s.type&&o>=a&&s.isActive&&B.alert(s.content,s.title,{type:s.effect,callback:()=>{H.announcement={_id:s._id,nextTime:Date.now()+24*s.nextTime*60*60*1e3}},showCancelButton:!1,confirmButtonText:"知道了",dangerouslyUseHTMLString:!0})}}catch({response:o}){q.error(null==(s=null==o?void 0:o.data)?void 0:s.error)}})(),K.value){const e=K.value.getElementsByTagName("script"),t=K.value.getElementsByTagName("style");for(let n of t){const e=document.createElement("style");e.textContent=n.textContent,document.head.appendChild(e)}for(let n of e){const e=document.createElement("script");e.textContent=n.textContent,n.parentNode.replaceChild(e,n)}}if(H.token)try{await(async()=>{var e;try{const{data:e}=await X.post("/api/auth/info");H.user=e}catch({response:t}){q.error(null==(e=null==t?void 0:t.data)?void 0:e.error)}})()}catch(e){await re()}})),(e,t)=>{var n,s,o,a,i,N;const x=f,M=E,$=P,q=w,B=L,F=l("router-link"),Q=C,W=l("router-view"),X=U;return u(),r("div",ee,[c("div",te,[c("div",ne,[c("div",{class:"hamburger",onClick:t[0]||(t[0]=e=>z.value=!z.value)},[d(v(_))])]),c("div",se,[d(B,{arrow:{pointAtCenter:!0}},{overlay:p((()=>[v(H).token?(u(),y(q,{key:0},{default:p((()=>[d(M,{key:"user",onClick:t[2]||(t[2]=e=>{var t,n;return v(G).push(`/user/${null==(n=null==(t=v(H))?void 0:t.user)?void 0:n._id}`)})},{default:p((()=>[d(v(h)),t[8]||(t[8]=b(" 个人主页 "))])),_:1,__:[8]}),d(M,{key:"settings",onClick:t[3]||(t[3]=e=>v(G).push("/settings"))},{default:p((()=>[d(v(k)),t[9]||(t[9]=b(" 个人设置 "))])),_:1,__:[9]}),d($),d(M,{key:"logout",onClick:re},{default:p((()=>[d(v(A)),t[10]||(t[10]=b(" 退出登录 "))])),_:1,__:[10]})])),_:1})):(u(),y(q,{key:1},{default:p((()=>[d(M,{key:"user",onClick:t[4]||(t[4]=e=>v(G).push("/login"))},{default:p((()=>[d(v(h)),t[11]||(t[11]=b(" 登录账号 "))])),_:1,__:[11]}),d($),d(M,{key:"settings",onClick:t[5]||(t[5]=e=>v(G).push("/register"))},{default:p((()=>[d(v(D)),t[12]||(t[12]=b(" 注册账号 "))])),_:1,__:[12]})])),_:1}))])),default:p((()=>{var e,n,s,o,a;return[c("a",{class:"user-dropdown",onClick:t[1]||(t[1]=g((()=>{}),["prevent"]))},[d(x,{size:32,src:(null==(s=null==(n=null==(e=v(H))?void 0:e.config)?void 0:n.site)?void 0:s.url)+(null==(a=null==(o=v(H))?void 0:o.user)?void 0:a.avatar)},{icon:p((()=>[d(v(h))])),_:1},8,["src"])])]})),_:1})])]),d(X,{locale:v(S)},{default:p((()=>{var e,n,s,o,a,i;return[c("div",{class:O(["mask",{"mask-active":z.value}]),onClick:t[6]||(t[6]=e=>z.value=!1)},null,2),c("div",{class:O(["menu",{"menu-active":z.value}])},[c("div",oe,[d(F,{to:"/"},{default:p((()=>{var e,t;return[b(R(null==(t=null==(e=v(H).config)?void 0:e.site)?void 0:t.title),1)]})),_:1})]),d(q,{selectedKeys:J.value,"onUpdate:selectedKeys":t[7]||(t[7]=e=>J.value=e),"open-keys":["admin"],theme:"dark",mode:"inline"},{default:p((()=>{var e;return[(u(!0),r(T,null,I(Y.value,(e=>(u(),r(T,null,[e.show?(u(),y(M,{key:e.name},{default:p((()=>[d(F,{to:e.url},{default:p((()=>[(u(),y(j(e.icon))),b(" "+R(e.title),1)])),_:2},1032,["to"])])),_:2},1024)):m("",!0)],64)))),256)),(null==(e=v(H).user)?void 0:e.founder)?(u(),y(Q,{key:"admin"},{title:p((()=>[c("span",null,[d(v(k)),t[13]||(t[13]=b(" 后台管理 "))])])),default:p((()=>[(u(),r(T,null,I(Z,(e=>d(M,{key:e.name},{default:p((()=>[d(F,{to:`/admin/${e.name}`},{default:p((()=>[b(R(e.title),1)])),_:2},1032,["to"])])),_:2},1024))),64))])),_:1})):m("",!0),v(H).token?m("",!0):(u(),y(M,{key:"login"},{default:p((()=>[d(F,{to:"/login"},{default:p((()=>[d(v(h)),t[14]||(t[14]=b(" 注册 / 登录 "))])),_:1,__:[14]})])),_:1})),v(H).token?(u(),y(M,{key:"logout",style:{float:"right"},onClick:re},{default:p((()=>[d(v(V)),t[15]||(t[15]=b(" 退出登录 "))])),_:1,__:[15]})):m("",!0)]})),_:1},8,["selectedKeys"])],2),c("div",{class:O(["content",J.value])},[d(W)],2),c("div",ae,[b(" All rights reserved © "+R((new Date).getFullYear())+" ",1),t[17]||(t[17]=c("a",{class:"goLink",type:"link",href:"https://github.com/setube/stb",target:"_blank"},"Stb",-1)),(null==(s=null==(n=null==(e=v(H))?void 0:e.config)?void 0:n.site)?void 0:s.beian)?(u(),r(T,{key:0},[t[16]||(t[16]=b(" ・ ")),c("a",ie,R(null==(i=null==(a=null==(o=v(H))?void 0:o.config)?void 0:a.site)?void 0:i.beian),1)],64)):m("",!0)])]})),_:1},8,["locale"]),(null==(o=null==(s=null==(n=v(H))?void 0:n.config)?void 0:s.site)?void 0:o.html)?(u(),r("div",{key:0,ref_key:"htmlContainer",ref:K,innerHTML:null==(N=null==(i=null==(a=v(H))?void 0:a.config)?void 0:i.site)?void 0:N.html},null,8,le)):m("",!0)])}}},[["__scopeId","data-v-04425913"]]),ue={},ce=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map((e=>Promise.resolve(e).then((e=>({status:"fulfilled",value:e})),(e=>({status:"rejected",reason:e}))))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),o=(null==n?void 0:n.nonce)||(null==n?void 0:n.getAttribute("nonce"));s=e(t.map((e=>{if((e=function(e){return"/"+e}(e))in ue)return;ue[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,o&&s.setAttribute("nonce",o),document.head.appendChild(s),t?new Promise(((t,n)=>{s.addEventListener("load",t),s.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then((t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)}))},de=(e,t,n)=>{const s=e[t];return s?"function"==typeof s?s():Promise.resolve(s):new Promise(((e,s)=>{("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==n?". Note that variables only represent file names one level deep.":""))))}))},me=["Dashboard","Users","Images","Config","Logs","InviteCodes","Albums","RoleGroups","Announcements"],ve=["404","RootRedirect","Login","Register","Home","Gallery","Docs","My","ResetPassword","Settings","admin","UserPage","UserPublicAlbumDetail"].map((e=>{let t={path:`/${e.toLowerCase()}`,name:e,component:()=>de(Object.assign({"../views/Docs.vue":()=>ce((()=>import("./Docs-B5YfUMSX.js")),__vite__mapDeps([0,1,2,3])),"../views/Gallery.vue":()=>ce((()=>import("./Gallery-n1uC2e8O.js")),__vite__mapDeps([4,1,2,5,6,7,8,9])),"../views/Home.vue":()=>ce((()=>import("./Home-6-0TPyDh.js")),__vite__mapDeps([10,1,2,7,11])),"../views/Login.vue":()=>ce((()=>import("./Login-9l3RuAuk.js")),__vite__mapDeps([12,1,2,13,14,15])),"../views/My.vue":()=>ce((()=>import("./My-BRjIdCfe.js")),__vite__mapDeps([16,1,2,7,6,8,17])),"../views/Not.vue":()=>ce((()=>import("./Not-CwyOAELb.js")),__vite__mapDeps([18,5,1,2])),"../views/Register.vue":()=>ce((()=>import("./Register-D8h7w0jo.js")),__vite__mapDeps([19,1,2,13,14,20])),"../views/ResetPassword.vue":()=>ce((()=>import("./ResetPassword-CI7AcKCg.js")),__vite__mapDeps([21,1,2,22])),"../views/Settings.vue":()=>ce((()=>import("./Settings-BYvvCdpO.js")),__vite__mapDeps([23,1,2,24]))}),`../views/${e}.vue`,3)};return"404"===e&&(t={path:"/:pathMatch(.*)*",name:e,component:()=>ce((()=>import("./Not-CwyOAELb.js")),__vite__mapDeps([18,5,1,2]))}),"RootRedirect"===e&&(t={path:"/",name:e,component:()=>ce((()=>import("./Home-6-0TPyDh.js")),__vite__mapDeps([10,1,2,7,11]))}),"admin"===e&&(t={path:"/admin",redirect:"/admin/dashboard",children:me.map((e=>({path:e.toLowerCase(),name:e,component:()=>de(Object.assign({"../views/admin/Albums.vue":()=>ce((()=>import("./Albums-BNnkeUdg.js")),__vite__mapDeps([25,1,2,7,26])),"../views/admin/Announcements.vue":()=>ce((()=>import("./Announcements-DZZGhZ3k.js")),__vite__mapDeps([27,1,2,7,28])),"../views/admin/Config.vue":()=>ce((()=>import("./Config-iHjIVkg8.js")),__vite__mapDeps([29,7,1,2,30])),"../views/admin/Dashboard.vue":()=>ce((()=>import("./Dashboard-DPDkKNvj.js")),__vite__mapDeps([31,1,2,32])),"../views/admin/Images.vue":()=>ce((()=>import("./Images-DZ2e99ti.js")),__vite__mapDeps([33,1,2,7,34])),"../views/admin/InviteCodes.vue":()=>ce((()=>import("./InviteCodes-BgoW2MNz.js")),__vite__mapDeps([35,1,2,7,36])),"../views/admin/Logs.vue":()=>ce((()=>import("./Logs-l-SRRieQ.js")),__vite__mapDeps([37,1,2,7,38])),"../views/admin/RoleGroups.vue":()=>ce((()=>import("./RoleGroups-DiZtqGTu.js")),__vite__mapDeps([39,1,2,7,40])),"../views/admin/Users.vue":()=>ce((()=>import("./Users-B-CXa6EZ.js")),__vite__mapDeps([41,1,2,7,42]))}),`../views/admin/${e}.vue`,4)})))}),"UserPage"===e&&(t={path:"/user/:userId",name:e,component:()=>de(Object.assign({"../views/user/UserPage.vue":()=>ce((()=>import("./UserPage-CyWIf2aQ.js")),__vite__mapDeps([43,1,2,7,44])),"../views/user/UserPublicAlbumDetail.vue":()=>ce((()=>import("./UserPublicAlbumDetail-CgWzgIZF.js")),__vite__mapDeps([45,1,2,46]))}),`../views/user/${e}.vue`,4)}),"UserPublicAlbumDetail"===e&&(t={path:"/user/:userId/album/:albumId",name:e,component:()=>de(Object.assign({"../views/user/UserPage.vue":()=>ce((()=>import("./UserPage-CyWIf2aQ.js")),__vite__mapDeps([43,1,2,7,44])),"../views/user/UserPublicAlbumDetail.vue":()=>ce((()=>import("./UserPublicAlbumDetail-CgWzgIZF.js")),__vite__mapDeps([45,1,2,46]))}),`../views/user/${e}.vue`,4)}),t})),_e=G({history:H(),routes:ve});_e.beforeEach(((e,t,n)=>{var s,o,a,i,l;const{config:r,token:u,user:c}=F();if("/"===e.path){const t=null==(s=null==r?void 0:r.site)?void 0:s.navigationOrder[0],o=t.replace(t[0],t[0].toUpperCase());if(e.name!==o)return n({name:o})}return u&&["Login","Register","ResetPassword"].includes(e.name)?n("/"):("Docs"!==e.name||(null==(o=null==r?void 0:r.site)?void 0:o.api))&&("Register"!==e.name||(null==(a=null==r?void 0:r.site)?void 0:a.register))&&("Gallery"!==e.name||(null==(i=null==r?void 0:r.site)?void 0:i.gallery))&&("Admin"!==e.name||u&&(null==(l=null==c?void 0:c.role)?void 0:l.isAdmin))?"My"!==e.name||u?void n():n("/login"):n({name:"404"})}));const pe=J(re),ge=z();ge.use(K),pe.use(ge),pe.use(_e),pe.mount("#app");export{Z as _,X as i,F as u};
