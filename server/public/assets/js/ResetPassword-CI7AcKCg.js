import{r as a,al as e,e as l,f as s,h as d,k as i,i as r,am as o,an as n,ao as u,j as t,a2 as v,p,ap as m,$ as f,I as c,a4 as y,b as _,aF as w,aG as g,ar as h}from"./vendor-DLaggKmm.js";import{_ as b,u as P,i as k}from"./index-CxgfQBo3.js";const x={class:"reset-password"},q={key:0},F={key:1},U={key:2},j=b({__name:"ResetPassword",setup(b){const j=_(),M=P(),S=a(0),T=a(!1),I=a(""),E=e({email:""}),G=e({code:""}),R=e({password:"",confirmPassword:""}),$=async(a,e)=>{if(e!==R.password)throw new Error("两次输入的密码不一致")},z=async()=>{var a,e,l;if(null==(e=null==(a=null==M?void 0:M.config)?void 0:a.smtp)?void 0:e.enabled)try{T.value=!0,await k.post("/api/auth/send-code",y.stringify({email:E.email,type:"reset"})),c.success("验证码已发送到您的邮箱"),S.value=1}catch({response:s}){c.error((null==(l=null==s?void 0:s.data)?void 0:l.error)||"发送验证码失败")}finally{T.value=!1}else c.warning("SMTP功能未开启, 请联系管理员")},A=async()=>{var a,e,l;if(null==(e=null==(a=null==M?void 0:M.config)?void 0:a.smtp)?void 0:e.enabled)if(1===S.value)try{T.value=!0;const{data:a}=await k.post("/api/auth/verify-code",y.stringify({email:E.email,code:G.code}));I.value=a.token,S.value=2}catch({response:s}){c.error((null==(l=null==s?void 0:s.data)?void 0:l.error)||"验证码验证失败")}finally{T.value=!1}else c.warning("请先完成邮箱验证");else c.warning("SMTP功能未开启, 请联系管理员")},B=async()=>{var a,e,l;if(null==(e=null==(a=null==M?void 0:M.config)?void 0:a.smtp)?void 0:e.enabled)if(2===S.value)try{T.value=!0,await k.post("/api/auth/reset-password",y.stringify({token:I.value,password:R.password})),c.success("您的密码已经重置成功，请使用新密码登录"),j.push("/login")}catch({response:s}){c.error((null==(l=null==s?void 0:s.data)?void 0:l.error)||"重置密码失败")}finally{T.value=!1}else c.warning("请先完成验证码验证");else c.warning("SMTP功能未开启, 请联系管理员")};return(a,e)=>{const c=u,y=n,_=v,b=o,P=m,k=f;return s(),l("div",x,[d(k,{class:"reset-card",title:"找回密码"},{default:i((()=>[0===S.value?(s(),l("div",q,[d(b,{model:E,onFinish:z},{default:i((()=>[d(y,{name:"email",rules:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入有效的邮箱地址"}]},{default:i((()=>[d(c,{value:E.email,"onUpdate:value":e[0]||(e[0]=a=>E.email=a),type:"email",placeholder:"请输入注册邮箱"},{prefix:i((()=>[d(t(w))])),_:1},8,["value"])])),_:1}),d(y,null,{default:i((()=>[d(_,{type:"primary",disabled:!E.email,"html-type":"submit",loading:T.value},{default:i((()=>e[4]||(e[4]=[p(" 发送验证码 ")]))),_:1,__:[4]},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])):r("",!0),1===S.value?(s(),l("div",F,[d(b,{model:G,onFinish:A},{default:i((()=>[d(y,{name:"code",rules:[{required:!0,message:"请输入验证码"}]},{default:i((()=>[d(c,{value:G.code,"onUpdate:value":e[1]||(e[1]=a=>G.code=a),placeholder:"请输入验证码"},{prefix:i((()=>[d(t(g))])),_:1},8,["value"])])),_:1}),d(y,null,{default:i((()=>[d(_,{type:"primary",disabled:!G.code,"html-type":"submit",loading:T.value},{default:i((()=>e[5]||(e[5]=[p("验证")]))),_:1,__:[5]},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])):r("",!0),2===S.value?(s(),l("div",U,[d(b,{model:R,onFinish:B},{default:i((()=>[d(y,{name:"password",rules:[{required:!0,message:"请输入新密码"},{min:6,message:"密码长度不能小于6位"}]},{default:i((()=>[d(P,{value:R.password,"onUpdate:value":e[2]||(e[2]=a=>R.password=a),placeholder:"请输入新密码"},{prefix:i((()=>[d(t(h))])),_:1},8,["value"])])),_:1}),d(y,{name:"confirmPassword",rules:[{required:!0,message:"请确认密码"},{validator:$}]},{default:i((()=>[d(P,{value:R.confirmPassword,"onUpdate:value":e[3]||(e[3]=a=>R.confirmPassword=a),placeholder:"请确认新密码"},{prefix:i((()=>[d(t(h))])),_:1},8,["value"])])),_:1},8,["rules"]),d(y,null,{default:i((()=>[d(_,{type:"primary","html-type":"submit",disabled:!R.password||!R.confirmPassword,loading:T.value},{default:i((()=>e[6]||(e[6]=[p(" 重置密码 ")]))),_:1,__:[6]},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])):r("",!0)])),_:1})])}}},[["__scopeId","data-v-a00f867f"]]);export{j as default};
