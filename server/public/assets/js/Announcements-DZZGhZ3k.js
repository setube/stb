import{r as e,o as a,e as l,g as t,h as u,k as n,I as s,a2 as r,au as i,ay as d,f as o,p as v,aM as c,aN as p,v as m,aO as f,j as _,aP as y,aQ as T,am as b,an as w,ao as h,aR as x,a0 as k,ax as U,F as Y,x as q,aS as A,aT as g,aU as C,aV as M}from"./vendor-DLaggKmm.js";import{_ as D,i as H}from"./index-CxgfQBo3.js";import{a as j}from"./formatDate-DJT1dS-E.js";const I={class:"announcements"},O={class:"header"},R=D({__name:"Announcements",setup(D){const R=e([]),$=e(!1),z=e("create"),F=e(!0),L=e({title:"",content:"",type:"modal",startTime:null,endTime:null,nextTime:null,isActive:!0}),N=["primary","success","info","warning","error"],P=async()=>{var e;F.value=!0;try{const{data:e}=await H.post("/api/admin/announcements");R.value=e}catch({response:a}){s.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}finally{F.value=!1}},Q=()=>{z.value="create",L.value={},$.value=!0},S=async()=>{var e;try{"create"===z.value?(await H.post("/api/admin/announcements/new",L.value),s.success("创建成功")):(await H.put(`/api/admin/announcements/${L.value._id}`,L.value),s.success("更新成功")),$.value=!1,P()}catch({response:a}){s.error(null==(e=null==a?void 0:a.data)?void 0:e.error)}};return a((()=>{P()})),(e,a)=>{const D=r,V=p,B=f,E=y,G=T,J=c,K=i,W=h,X=w,Z=x,ee=U,ae=k,le=A,te=g,ue=C,ne=b,se=d;return o(),l("div",I,[t("div",O,[u(D,{type:"primary",onClick:Q},{default:n((()=>a[10]||(a[10]=[v("创建公告")]))),_:1,__:[10]})]),u(K,{spinning:F.value},{default:n((()=>[u(J,{data:R.value,"scrollbar-always-on":"",fit:""},{default:n((()=>[u(V,{prop:"title",label:"标题",fixed:""}),u(V,{label:"类型"},{default:n((({row:e})=>[v(m("modal"===e.type?"弹窗":"提示"),1)])),_:1}),u(V,{label:"主题"},{default:n((({row:e})=>[u(B,{type:e.effect,"disable-transitions":""},{default:n((()=>[v(m(e.effect),1)])),_:2},1032,["type"])])),_:1}),u(V,{prop:"startTime",sortable:"",label:"开始时间"},{default:n((({row:e})=>[v(m(_(j)(e.startTime)),1)])),_:1}),u(V,{prop:"endTime",sortable:"",label:"结束时间"},{default:n((({row:e})=>[v(m(_(j)(e.endTime)),1)])),_:1}),u(V,{prop:"nextTime",sortable:"",label:"下次显示时间"},{default:n((({row:e})=>[v(m(e.nextTime)+"天",1)])),_:1}),u(V,{label:"状态"},{default:n((({row:e})=>[u(B,{type:e.isActive?"success":"info","disable-transitions":""},{default:n((()=>[v(m(e.isActive?"有效":"无效"),1)])),_:2},1032,["type"])])),_:1}),u(V,{label:"操作",fixed:"right"},{default:n((({row:e})=>[u(E,{type:"primary",link:"",onClick:a=>(e=>{z.value="edit",L.value=e,L.value.startTime=e.startTime?M(e.startTime):null,L.value.endTime=e.endTime?M(e.endTime):null,$.value=!0})(e)},{default:n((()=>a[11]||(a[11]=[v("编辑")]))),_:2,__:[11]},1032,["onClick"]),u(G,{title:"确定要删除这条公告吗？","ok-text":"确定","cancel-text":"取消",onConfirm:a=>(async e=>{var a;try{await H.delete(`/api/admin/announcements/${e._id}`),s.success("删除成功"),P()}catch({response:l}){s.error(null==(a=null==l?void 0:l.data)?void 0:a.error)}})(e)},{default:n((()=>[u(E,{type:"danger",link:""},{default:n((()=>a[12]||(a[12]=[v("删除")]))),_:1,__:[12]})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])])),_:1},8,["spinning"]),u(se,{title:"create"===z.value?"创建公告":"编辑公告",open:$.value,"onUpdate:open":a[8]||(a[8]=e=>$.value=e),onOk:S,onCancel:a[9]||(a[9]=e=>$.value=!1)},{default:n((()=>[u(ne,{model:L.value,layout:"vertical"},{default:n((()=>[u(X,{label:"标题",required:""},{default:n((()=>[u(W,{value:L.value.title,"onUpdate:value":a[0]||(a[0]=e=>L.value.title=e),placeholder:"请输入公告标题"},null,8,["value"])])),_:1}),u(X,{label:"内容",required:""},{default:n((()=>[u(Z,{value:L.value.content,"onUpdate:value":a[1]||(a[1]=e=>L.value.content=e),placeholder:"请输入公告内容, 支持HTML, 不支持输出<style>标签和<script>标签","auto-size":{minRows:4}},null,8,["value"])])),_:1}),u(X,{label:"类型",required:""},{default:n((()=>[u(ae,{value:L.value.type,"onUpdate:value":a[2]||(a[2]=e=>L.value.type=e),placeholder:"请选择公告类型"},{default:n((()=>[u(ee,{value:"modal"},{default:n((()=>a[13]||(a[13]=[v("弹窗")]))),_:1,__:[13]}),u(ee,{value:"alert"},{default:n((()=>a[14]||(a[14]=[v("提示")]))),_:1,__:[14]})])),_:1},8,["value"])])),_:1}),u(X,{label:"主题",required:""},{default:n((()=>[u(ae,{value:L.value.effect,"onUpdate:value":a[3]||(a[3]=e=>L.value.effect=e),placeholder:"请选择公告主题"},{default:n((()=>[(o(),l(Y,null,q(N,(e=>u(ee,{value:e,key:e},{default:n((()=>[v(m(e),1)])),_:2},1032,["value"]))),64))])),_:1},8,["value"])])),_:1}),u(X,{label:"开始时间",required:""},{default:n((()=>[u(le,{style:{width:"100%"},value:L.value.startTime,"onUpdate:value":a[4]||(a[4]=e=>L.value.startTime=e),format:"YYYY/MM/DD HH:mm:ss"},null,8,["value"])])),_:1}),u(X,{label:"结束时间",required:""},{default:n((()=>[u(le,{style:{width:"100%"},value:L.value.endTime,"onUpdate:value":a[5]||(a[5]=e=>L.value.endTime=e),format:"YYYY/MM/DD HH:mm:ss"},null,8,["value"])])),_:1}),u(X,{label:"关闭公告后多久显示",required:""},{default:n((()=>[u(te,{style:{width:"100%"},value:L.value.nextTime,"onUpdate:value":a[6]||(a[6]=e=>L.value.nextTime=e),placeholder:"请输入天数",min:1},{addonAfter:n((()=>a[15]||(a[15]=[v("天")]))),_:1},8,["value"])])),_:1}),u(X,{label:"公告状态"},{default:n((()=>[u(ue,{checked:L.value.isActive,"onUpdate:checked":a[7]||(a[7]=e=>L.value.isActive=e)},null,8,["checked"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","open"])])}}},[["__scopeId","data-v-8506c5d9"]]);export{R as default};
